# 记录rtos创建任务的流程

- 使用`xTaskCreate`创建任务，会分配`Stack`和`TCB`的地址，而这些地址的来源是`heap_4`中，定义了一个非常大的数组

- 分配好地址之后，会调用函数`prvInitialiseNewTask`初始化新任务

`prvInitialiseNewTask` 函数中：
1. 根据要求判断是否需要填充栈为0XA5（方便调试的时候观察）
2. 计算栈顶的地址
3. 将任务名字复制给`TCB`中的`pcTaskName`，如果没有默认的名字，则会变成赋值为0x00
4. 将任务优先级复制给`TCB`，会判断是否超过最大优先级
5. 如果开启了互斥量，会将优先级复制给互斥量，此目的是为了解决优先级翻转的问题，所以会记录当前任务的优先级
6. 初始化列表项，使用宏定义`vListInitialiseItem`
7. 将列表项的值赋值给`pxNewTCB`，使用宏定义`listSET_LIST_ITEM_OWNER`
8. 根据宏定义开启一些函数的初始化，例如`configUSE_TASK_NOTIFICATIONS`任务通知api
9. 初始化任务堆栈，伪造中断返回现场，让任务第一次运行就像被中断唤醒一样自然

- 初始化新任务后，会调用函数`prvAddNewTaskToReadyList`添加新任务到就绪列表中